<% content_for :page_title do %>
  <%= t('.welcome_html') %>
<% end %>
<p>Voordat u Cwic kunt gebruiken dient u eerst uw favorieten kleurbepalingsalgoritme te kiezen uit de lijst hieronder.</p>

<%
def hex_color_to_rgb(color)
  color = color[1..7] if color[0] == '#'
  color.scan(/../).map { |c| c.to_i(16) }
end

def color_difference(color1, color2)
  color1 = hex_color_to_rgb(color1)
  color2 = hex_color_to_rgb(color2)
  [color1[0], color2[0]].max - [color1[0], color2[0]].max + [color1[1], color2[1]].max - [color1[1], color2[1]].min + [color1[2], color2[2]].max - [color1[2], color2[2]].min
end

def color_brightness_difference(color1, color2)
  color1 = hex_color_to_rgb(color1)
  color2 = hex_color_to_rgb(color2)
  br1 = (299 * color1[0] + 587 * color1[1] + 114 * color1[2]) / 1000
  br2 = (299 * color2[0] + 587 * color2[1] + 114 * color2[2]) / 1000
  (br1-br2).abs
end

def color_pythagorean_difference(color1, color2)
  color1 = hex_color_to_rgb(color1)
  color2 = hex_color_to_rgb(color2)
  Math.sqrt((color1[0] - color2[0]) ** 2 + (color1[1] - color2[1]) ** 2 + (color1[2] - color2[2]) ** 2)
end

def color_luminosity_difference(color1, color2)
  color1 = hex_color_to_rgb(color1)
  color2 = hex_color_to_rgb(color2)
  l1 = 0.2126 * ((color1[0] / 225.0) ** 2.2) + 0.7152 * ((color1[1] / 225.0) ** 2.2) + 0.0722 * ((color1[2] / 225.0) ** 2.2)
  l2 = 0.2126 * ((color2[0] / 225.0) ** 2.2) + 0.7152 * ((color2[1] / 225.0) ** 2.2) + 0.0722 * ((color2[2] / 225.0) ** 2.2)
  if l1 > l2
    (l1 + 0.05) / (l2 + 0.05)
  else
    (l2 + 0.05) / (l1 + 0.05)
  end
end

def bw_text_color(hex_bg_color)
  rgb_bg_color = hex_color_to_rgb(hex_bg_color)
  bg_brightness = rgb_bg_color.sum
  (bg_brightness < 383 ? '#FFFFFF' : '#444444')
end

def text_color(bg_color, diff_method)
  max_d = 0
  max_color = nil
  colors = ['#000000', '#FFFFFF']
  colors.each do |color|
    d = self.send(diff_method, bg_color, color)
    if d > max_d
      max_d = d
      max_color = color
    end
  end
  max_color
end

def array_diff(*arr)
  arr.uniq.length > 1
end
%>

<% (0..15).each do |a| %>
<% color = (a.to_s(16) + "0" + a.to_s(16) + "0" + a.to_s(16) + "0") %>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 1px; font-size: 20px; line-height: 50px; text-align: center; color: <%= bw_text_color(color) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met bw...</div>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 1px; font-size: 20px; line-height: 50px; text-align: center; color: <%= text_color(color, :color_brightness_difference) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met brightness diff...</div>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 1px; font-size: 20px; line-height: 50px; text-align: center; color: <%= text_color(color, :color_luminosity_difference) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met luminosity diff...</div>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 10px; font-size: 20px; line-height: 50px; text-align: center; color: <%= text_color(color, :color_pythagorean_difference) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met pythagorean diff...</div>
<% end %>

<% (0..15).each do |a| %>
<% (0..15).each do |b| %>
<% (0..15).each do |c| %>
<% color = (a.to_s(16) + "8" + b.to_s(16) + "8" + c.to_s(16) + "8") %>
<% if array_diff(bw_text_color(color), text_color(color, :color_brightness_difference), text_color(color, :color_luminosity_difference), text_color(color, :color_pythagorean_difference)) %>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 1px; font-size: 20px; line-height: 50px; text-align: center; color: <%= bw_text_color(color) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met bw...</div>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 1px; font-size: 20px; line-height: 50px; text-align: center; color: <%= text_color(color, :color_brightness_difference) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met brightness diff...</div>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 1px; font-size: 20px; line-height: 50px; text-align: center; color: <%= text_color(color, :color_luminosity_difference) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met luminosity diff...</div>
<div style="width: 800px; height: 50px; background-color: #<%= color %>; margin-bottom: 10px; font-size: 20px; line-height: 50px; text-align: center; color: <%= text_color(color, :color_pythagorean_difference) %>;">Hoi allemaal. Dit is een stuk tekst! Hopelijk is dit leesbaar met pythagorean diff...</div>
<% end %>
<% end %>
<% end %>
<% end %>